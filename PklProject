amends "pkl:Project"

local envVersion = read?("env:PROJECT_VERSION") ?? "0.1.0-SNAPSHOT"
local projectVersion = if (envVersion.startsWith("v")) envVersion.substring(1, envVersion.length) else envVersion

package {
  name = "app"
  baseUri = "package://ghcr.io/hpklio/app"
  version = projectVersion
  packageZipUrl = "https://github/hpklio/app/releases/\(version)/app-\(version).zip"
}

dependencies {
  ["k8s"] {
    uri = "package://pkg.pkl-lang.org/pkl-k8s/k8s@1.0.1"
  }
}

tests {
  "tests/basic.pkl"
  "spring/tests/kafka.pkl"
  "spring/tests/couchbase.pkl"
  "spring/tests/datasource.pkl"
  "spring/tests/redis.pkl"
  "spring/tests/flyway.pkl"
  "spring/tests/grpc.pkl"
}
